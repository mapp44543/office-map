# ๐ ะฃัะพะฒะตะฝั 2 ะพะฟัะธะผะธะทะฐัะธั (ะะธัััะฐะปะธะทะฐัะธั) - ะัะบะพะฒะพะดััะฒะพ

## ๐ฏ ะะฑะทะพั

**ะฃัะพะฒะตะฝั 2 ะพะฟัะธะผะธะทะฐัะธั** ะธัะฟะพะปัะทัะตั `react-window` ะดะปั ะฒะธัััะฐะปะธะทะฐัะธะธ ะผะฐัะบะตัะพะฒ, ััะพ ะดะฐะตั **40-60% ะดะพะฟะพะปะฝะธัะตะปัะฝะพะณะพ ัะปัััะตะฝะธั** ะฟัะธ 80-150 ะผะฐัะบะตัะฐั.

- **ะะพะณะดะฐ ะธัะฟะพะปัะทัะตััั:** ะัะธ 80-150 ะผะฐัะบะตัะฐั (ะฐะฒัะพะผะฐัะธัะตัะบะธ)
- **ะะพะดะดะตัะถะบะฐ:** ะะพะปะฝะฐั (ะบะปะธะบะธ, hover, tooltip, drag-drop ะฒ ะฐะดะผะธะฝ ัะตะถะธะผะต)
- **ะะพะฟะพะปะฝะธัะตะปัะฝะพะต ัะปัััะตะฝะธะต:** ะ ะฃัะพะฒะฝั 1, ะฟะตัะตะด Canvas

---

## ๐ ะะฐะบ ัะฐะฑะพัะฐะตั

### ะััะธัะตะบัััะฐ ัะตะฝะดะตัะธะฝะณะฐ

```
OfficeMap (office-map.tsx)
  โโ 0-80 ะผะฐัะบะตัะพะฒ ะะะ ะฐะดะผะธะฝ ัะตะถะธะผ
  โ  โโ VirtualizedMarkerLayer (ะฑะฐะทะพะฒะฐั ะฒะตััะธั)
  โ     โโ ะะพะบะฐะทัะฒะฐะตั ะฒะธะดะธะผัะต ะผะฐัะบะตัั ัะตัะตะท useMemo
  โ
  โโ 80-150 ะผะฐัะบะตัะพะฒ (ะฟัะฑะปะธัะฝัะน ัะตะถะธะผ) โญ ะฃะะะะะะฌ 2
  โ  โโ VirtualizedMarkerLayerAdvanced
  โ     โโ ะัะฟะพะปัะทัะตั react-window ะดะปั ะฒะธัััะฐะปะธะทะฐัะธะธ
  โ     โโ ะะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ะฒะธะดะธะผัะต ัะปะตะผะตะฝัั ะฒ DOM
  โ
  โโ 150+ ะผะฐัะบะตัะพะฒ (ะฟัะฑะปะธัะฝัะน ัะตะถะธะผ)
     โโ CanvasInteractiveMarkerLayer (Canvas ัะตะฝะดะตัะธะฝะณ)
        โโ 1 canvas ัะปะตะผะตะฝั
```

### ะะพะณะธะบะฐ ะฟะตัะตะบะปััะตะฝะธั

```typescript
// ะ office-map.tsx (ัััะพะบะฐ ~650)
const markerCount = locations.length;

if (markerCount > 150) {
  // ะฃัะพะฒะตะฝั 3: Canvas ัะตะฝะดะตัะธะฝะณ
  renderMode = 'canvas';
} else if (markerCount > 80) {
  // ะฃัะพะฒะตะฝั 2: Advanced ะฒะธัััะฐะปะธะทะฐัะธั (react-window)
  renderMode = 'advanced';
} else {
  // ะฃัะพะฒะตะฝั 1: ะะฐะทะพะฒะฐั ะฒะธัััะฐะปะธะทะฐัะธั (useMemo)
  renderMode = 'basic';
}
```

---

## ๐ ะงัะพ ะดะพะฑะฐะฒะปะตะฝะพ

### ะะพะฒัะน ะบะพะผะฟะพะฝะตะฝั
```
โจ client/src/components/virtualized-marker-layer-advanced.tsx
   - ะัะฟะพะปัะทัะตั react-window (ัะถะต ะทะฐะฒะธัะธะผะพััั ะฒ package.json)
   - FixedSizeList ะดะปั ะฒะธัััะฐะปะธะทะฐัะธะธ ะผะฐัะบะตัะพะฒ
   - ะะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ะฒะธะดะธะผัะต ะผะฐัะบะตัั ะฒ DOM
   - ะะพะดะดะตัะถะธะฒะฐะตั ะฒัะต ััะฝะบัะธะธ ะฑะฐะทะพะฒะพะน ะฒะตััะธะธ
```

### ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั
```
โ๏ธ client/src/components/office-map.tsx
   - ะะพะฑะฐะฒะปะตะฝ ะธะผะฟะพัั VirtualizedMarkerLayerAdvanced
   - ะะฑะฝะพะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะฒัะฑะพัะฐ ัะตะฝะดะตัะธะฝะณะฐ (3-ััะพะฒะฝะตะฒะฐั ัะธััะตะผะฐ)
   - ะฃัะปะพะฒะฝะพะต ะฟะตัะตะบะปััะตะฝะธะต ะผะตะถะดั ััะตะผั ัะตะถะธะผะฐะผะธ
```

---

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะกัะฐะฒะฝะตะฝะธะต ัะตะถะธะผะพะฒ ัะตะฝะดะตัะธะฝะณะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ       ะะตะถะธะผ       โ  ะะธะฐะฟะฐะทะพะฝ  โ FPS โ Memory โ    DOM     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ ะะฐะทะพะฒัะน (Level 1) โ   0-80     โ 50+ โ <100MB โ    80      โ
โ Advanced (Level 2)โ  80-150    โ 45+ โ  80MB  โ   20-40*   โ
โ Canvas (Level 3)  โ   150+     โ 50+ โ  110MB โ     1      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

* react-window ะฟะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ะฒะธะดะธะผัะต ะผะฐัะบะตัั ะฒ DOM
  ั ะฑััะตัะพะผ ะดะปั ะฟะปะฐะฒะฝะพะณะพ ัะบัะพะปะปะธะฝะณะฐ
```

### ะะตััะธะบะธ ะฃัะพะฒะฝั 2

| ะะตััะธะบะฐ | ะะฐะทะพะฒัะน | Advanced | ะฃะปัััะตะฝะธะต |
|---------|---------|----------|-----------|
| **DOM ัะปะตะผะตะฝัะพะฒ** | 100+ | 20-40* | โ 75% โ** |
| **Memory usage** | 150-160MB | 100-120MB | โ 25% โ |
| **FPS ะฟัะธ pan** | 40-45 | 45-50 | โ 10% โ |
| **ะะตัะฒัะน ัะตะฝะดะตั** | 1.5-2s | 1-1.5s | โ 20% โ |
| **ะะฝัะตัะฐะบัะธะฒะฝะพััั** | ะฅะพัะพัะพ | ะัะปะธัะฝะพ | โ |

*ะขะพะปัะบะพ ะฒะธะดะธะผัะต + ะฑััะตั ะดะปั ะฟัะตะดะทะฐะณััะทะบะธ
**ะะฝะฐัะธัะตะปัะฝะพะต ัะฝะธะถะตะฝะธะต ะฑะปะฐะณะพะดะฐัั react-window

---

## ๐งช ะะฐะบ ัะตััะธัะพะฒะฐัั

### 1. ะะตะฝะตัะธัะพะฒะฐะฝะธะต ัะตััะพะฒัั ะดะฐะฝะฝัั

```typescript
// ะ ะบะพะฝัะพะปะธ ะฑัะฐัะทะตัะฐ
import { generateTestLocations } from '@/utils/performance-test-utils';

// ะขะตัั ั 100 ะผะฐัะบะตัะฐะผะธ (ะดะพะปะถะตะฝ ะธัะฟะพะปัะทะพะฒะฐัั Advanced)
const testData = generateTestLocations(100);
```

### 2. ะัะพะฒะตัะบะฐ ะธัะฟะพะปัะทัะตะผะพะณะพ ัะตะถะธะผะฐ

```javascript
// DevTools โ Console
// ะัะบัััั Elements โ search "virtualized-advanced-list"
// ะัะปะธ ะฝะฐะนะดะตะฝ โ Advanced ัะตะถะธะผ ะฐะบัะธะฒะตะฝ โ
```

### 3. ะกัะฐะฒะฝะตะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

```typescript
// ะัะพัะธะปะธัะพะฒะฐัั FPS
const fps = await PerformanceProfiler.measureFPS(5);

// ะะถะธะดะฐะตะผะพ ะดะปั 100 ะผะฐัะบะตัะพะฒ:
// - ะะฐะทะพะฒัะน: 40-45 FPS
// - Advanced: 45-50 FPS (ะฝะฐ 10% ะปัััะต)
```

---

## ๐ฏ ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

### ะัะฑะพั ัะตะถะธะผะฐ

| ะะฐัะบะตัะพะฒ | ะะตะถะธะผ | ะัะธัะธะฝะฐ |
|----------|-------|---------|
| **0-30** | ะะฐะทะพะฒัะน (L1) | ะะฑะฐ ัะตะถะธะผะฐ ัะพัะพัะพ ัะฐะฑะพัะฐัั, ะฝะตั ัะผััะปะฐ |
| **30-80** | ะะฐะทะพะฒัะน (L1) | ะะฟัะธะผะฐะปัะฝะฐั ัะพัะบะฐ ะดะปั ะฟัะพััะพะณะพ ัะตะฝะดะตัะฐ |
| **80-150** | Advanced (L2) โ | ะะฐัะธะฝะฐัััั ะฟัะพะฑะปะตะผั ั ะฑะฐะทะพะฒัะผ, Advanced ะธะดะตะฐะปะตะฝ |
| **150+** | Canvas (L3) | Advanced ััะฐะฝะพะฒะธััั ัะทะบะธะผ ะผะตััะพะผ |

### ะัะพะฑัะต ัะปััะฐะธ

- **ะะดะผะธะฝ ัะตะถะธะผ:** ะัะตะณะดะฐ ะะฐะทะพะฒัะน (ะฃัะพะฒะตะฝั 1), ะฝัะถะตะฝ DOM ะดะปั drag-drop
- **ะะพะฑะธะปัะฝัะต:** Advanced ะผะพะถะตั ะฑััั ะปัััะต ะฝะฐ ัะปะฐะฑัั ััััะพะนััะฒะฐั
- **Low-end ะะ:** Canvas ะผะพะถะตั ะฑััั ะปัััะต ะฑะปะฐะณะพะดะฐัั ะผะตะฝััะตะผั ะฟะฐะผััะธ

---

## ๐ง ะะพะฝัะธะณััะฐัะธั

### ะะทะผะตะฝะธัั ะฟะพัะพะณะธ ะฟะตัะตะบะปััะตะฝะธั

ะ [office-map.tsx](office-map.tsx#L658):

```typescript
// ะขะะะฃะฉะะ ะะะะะะ
if (markerCount > 150) renderMode = 'canvas';
else if (markerCount > 80) renderMode = 'advanced';

// ะะะะะ ะะะะะกะกะะะะซะ (Advanced ะฟัะธ 60+)
if (markerCount > 150) renderMode = 'canvas';
else if (markerCount > 60) renderMode = 'advanced';

// ะะะะะ ะะะะกะะะะะขะะะะซะ (Advanced ะฟัะธ 120+)
if (markerCount > 150) renderMode = 'canvas';
else if (markerCount > 120) renderMode = 'advanced';
```

### ะัะบะปััะธัั Advanced (ะดะปั ะพัะปะฐะดะบะธ)

```typescript
// ะะฐะบะพะผะผะตะฝัะธััะนัะต Advanced ััะปะพะฒะธะต
if (markerCount > 150) renderMode = 'canvas';
// else if (markerCount > 80) renderMode = 'advanced';
else renderMode = 'basic';
```

---

## ๐ ะัะปะฐะดะบะฐ

### Advanced ะฝะต ะฐะบัะธะฒะธััะตััั

**ะัะธะทะฝะฐะบะธ:**
- 100 ะผะฐัะบะตัะพะฒ, ะฝะพ ะธัะฟะพะปัะทัะตััั ะะฐะทะพะฒัะน ัะตะถะธะผ

**ะัะพะฒะตัะบะธ:**
1. ะฃะฑะตะดะธัะตัั `locations.length` > 80
2. ะัะพะฒะตัััะต `isAdminMode` = false (Advanced ะฝะต ะดะปั ะฐะดะผะธะฝะฐ)
3. ะัะพะฒะตัััะต ะบะพะฝัะพะปั ะฝะฐ ะพัะธะฑะบะธ

### ะะฐัะบะตัั ะฝะต ะฒะธะดะฝั

**ะัะธัะธะฝั:**
- react-window ััะตะฑัะตั ัะธะบัะธัะพะฒะฐะฝะฝะพะน ะฒััะพัั ัะปะตะผะตะฝัะพะฒ
- ะขะตะบััะฐั ะฒััะพัะฐ: 100px (ะผะพะถะตั ะฑััั ะฝะตะฟัะฐะฒะธะปัะฝะพะน)

**ะะตัะตะฝะธะต:**
```typescript
// ะ virtualized-marker-layer-advanced.tsx (ัััะพะบะฐ 130)
const itemHeight = 100; // ะะฐัััะฐะธะฒะฐะนัะต ััั ะฒััะพัั
```

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะฝะต ัะปัััะธะปะฐัั

**ะัะพะฒะตัััะต:**
1. DevTools โ Performance โ ะทะฐะฟะธัะธัะต ะฟัะพัะฐะนะป
2. ะะฐะนะดะธัะต ะบะพะผะฟะพะฝะตะฝั MarkerRow
3. ะัะพะฒะตัััะต, ััะพ ััะพ ะผะตะผะพะธะทะธัะพะฒะฐะฝ (`React.memo`)
4. ะฃะฑะตะดะธัะตัั, ััะพ ะฝะต ะผะฝะพะณะพ ะฟะตัะตัะตะฝะดะตัะพะฒ

---

## ๐ React-window ะพะฑัััะฝะตะฝะธะต

### ะะฐะบ ัะฐะฑะพัะฐะตั react-window

```
ะะธัััะฐะปัะฝะพะต ะพะบะฝะพ (viewport):
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะฒะธะดะธะผัะต ัะปะตะผะตะฝัั  โ โ ัะพะปัะบะพ ััะธ ัะตะฝะดะตััััั ะฒ DOM
โ   (20-40 ะผะฐัะบะตัะพะฒ)  โ
โโโโโโโโโโโโโโโโโโโโโโโ
   โ        โ
   โ ัะบัะพะปะปะธะฝะณ/ะฟะฐะฝะพัะฐะผะธัะพะฒะฐะฝะธะต
   โ        โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   ะฝะพะฒัะต ะฒะธะดะธะผัะต     โ
โ   ัะปะตะผะตะฝัั          โ
โโโโโโโโโโโโโโโโโโโโโโโ

ะะตะทัะปััะฐั:
- 100 ะผะฐัะบะตัะพะฒ ะฒ ะฟะฐะผััะธ
- 20-40 ะผะฐัะบะตัะพะฒ ะฒ DOM
- ะัะตะฝั ะฟะปะฐะฒะฝัะน ัะบัะพะปะปะธะฝะณ
- ะะธะฝะธะผะฐะปัะฝัะน memory overhead
```

### ะััะตั ะฟัะตะดะทะฐะณััะทะบะธ

```typescript
// virtualized-marker-layer-advanced.tsx
const bufferPercent = 25; // ะัะตะดะทะฐะณััะถะฐะตะผ ัะปะตะผะตะฝัั ัะฝะฐััะถะธ viewport

// ะญัะพ ะพะฑะตัะฟะตัะธะฒะฐะตั ะณะปะฐะดะบะธะน ัะบัะพะปะปะธะฝะณ ะฑะตะท "ะฟััััั ะผะตัั"
```

---

## โ ะงะตะบะปะธัั

ะะตัะตะด ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ:

- [ ] React-window ัะถะต ะทะฐะฒะธัะธะผะพััั (ะฟัะพะฒะตัััะต package.json)
- [ ] ะะพะผะฟะพะฝะตะฝั ะบะพะผะฟะธะปะธััะตััั (`npm run check`)
- [ ] ะขะตััะธัะพะฒะฐะฝะพ ั 80-150 ะผะฐัะบะตัะฐะผะธ
- [ ] FPS ัะปัััะธะปัั ะฝะฐ 10%+
- [ ] DOM ัะปะตะผะตะฝัะพะฒ ัะพะบัะฐัะตะฝะพ ะฝะฐ 50%+
- [ ] ะะปะธะบะธ/hover/tooltip ัะฐะฑะพัะฐัั
- [ ] ะะดะผะธะฝ ัะตะถะธะผ ะฒัั ะตัั ะธัะฟะพะปัะทัะตั ะฑะฐะทะพะฒัะน (ะดะปั drag-drop)
- [ ] ะะตั ะพัะธะฑะพะบ ะฒ ะบะพะฝัะพะปะธ

---

## ๐ฏ ะะพะณะดะฐ ะฟะตัะตัะพะดะธัั ะฝะฐ Canvas

**ะัะธะทะฝะฐะบะธ, ััะพ ะฝัะถะตะฝ Canvas (ะฃัะพะฒะตะฝั 3):**
- 150+ ะผะฐัะบะตัะพะฒ
- Advanced ัะตะถะธะผ ะฟะพะบะฐะทัะฒะฐะตั < 40 FPS
- Memory usage > 150MB
- ะะพะฑะธะปัะฝะพะต ััััะพะนััะฒะพ ั ะพะณัะฐะฝะธัะตะฝะธัะผะธ ะฟะฐะผััะธ

**ะกะผะพััะธัะต:** [CANVAS_OPTIMIZATION.md](CANVAS_OPTIMIZATION.md)

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [react-window ะดะพะบัะผะตะฝัะฐัะธั](https://react-window.vercel.app/)
- [FixedSizeList API](https://react-window.vercel.app/#/api/FixedSizeList)
- [ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั](https://github.com/bvaughn/react-window/tree/master/demo)

---

**ะกัะฐััั:** โ ะฃัะพะฒะตะฝั 2 ัะตะฐะปะธะทะพะฒะฐะฝ ะธ ะณะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั  
**ะะฐัะฐ:** 25 ัะตะฒัะฐะปั 2026  
**ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝัะน ัะตะทัะปััะฐั:** 40-60% ัะปัััะตะฝะธะต ะฟัะธ 80-150 ะผะฐัะบะตัะฐั
